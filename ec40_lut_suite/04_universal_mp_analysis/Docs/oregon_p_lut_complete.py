"""
LUT Completa de P per Oregon Scientific THN132N (House 247)
Generada automàticament combinant totes les captures.
"""

# Transformacions XOR per diferents rolling codes
NIB7_XOR_TABLE = {
    0x0: 0x6,
    0x1: 0xD,
    0x2: 0x0,
    0x8: 0x7,
}

# LUT Base (per Nib7=2)
# Índex: temp_idx = int((temp_c + 40) * 10)
P_LUT_BASE = {
     240: 0xA,  #  -16.0°C
     241: 0x4,  #  -15.9°C
     242: 0x3,  #  -15.8°C
     243: 0x7,  #  -15.7°C
     244: 0x0,  #  -15.6°C
     245: 0x9,  #  -15.5°C
     246: 0xE,  #  -15.4°C
     247: 0xC,  #  -15.3°C
     248: 0xB,  #  -15.2°C
     249: 0x2,  #  -15.1°C
     250: 0x5,  #  -15.0°C
     251: 0x1,  #  -14.9°C
     252: 0x6,  #  -14.8°C
     253: 0x2,  #  -14.7°C
     254: 0x5,  #  -14.6°C
     255: 0xC,  #  -14.5°C
     256: 0xB,  #  -14.4°C
     257: 0x9,  #  -14.3°C
     258: 0xE,  #  -14.2°C
     259: 0x7,  #  -14.1°C
     260: 0x0,  #  -14.0°C
     261: 0xA,  #  -13.9°C
     262: 0xD,  #  -13.8°C
     263: 0x9,  #  -13.7°C
     264: 0xE,  #  -13.6°C
     265: 0x7,  #  -13.5°C
     266: 0x0,  #  -13.4°C
     268: 0x5,  #  -13.2°C
     269: 0xC,  #  -13.1°C
     270: 0xB,  #  -13.0°C
     271: 0xF,  #  -12.9°C
     272: 0x8,  #  -12.8°C
     273: 0xC,  #  -12.7°C
     274: 0xB,  #  -12.6°C
     275: 0x2,  #  -12.5°C
     276: 0x5,  #  -12.4°C
     277: 0x7,  #  -12.3°C
     278: 0x0,  #  -12.2°C
     279: 0x9,  #  -12.1°C
     280: 0xE,  #  -12.0°C
     281: 0x0,  #  -11.9°C
     282: 0x7,  #  -11.8°C
     283: 0x3,  #  -11.7°C
     284: 0x4,  #  -11.6°C
     285: 0xD,  #  -11.5°C
     286: 0xA,  #  -11.4°C
     288: 0xF,  #  -11.2°C
     289: 0x6,  #  -11.1°C
     290: 0x1,  #  -11.0°C
     291: 0x5,  #  -10.9°C
     292: 0x2,  #  -10.8°C
     293: 0x6,  #  -10.7°C
     295: 0x8,  #  -10.5°C
     297: 0xD,  #  -10.3°C
     298: 0xA,  #  -10.2°C
     299: 0x3,  #  -10.1°C
     300: 0x4,  #  -10.0°C
     301: 0x8,  #   -9.9°C
     303: 0xB,  #   -9.7°C
     304: 0xC,  #   -9.6°C
     306: 0x2,  #   -9.4°C
     307: 0x0,  #   -9.3°C
     308: 0x7,  #   -9.2°C
     309: 0xE,  #   -9.1°C
     310: 0x9,  #   -9.0°C
     311: 0xD,  #   -8.9°C
     312: 0xA,  #   -8.8°C
     313: 0xE,  #   -8.7°C
     314: 0x9,  #   -8.6°C
     315: 0x0,  #   -8.5°C
     316: 0x7,  #   -8.4°C
     317: 0x5,  #   -8.3°C
     319: 0xB,  #   -8.1°C
     320: 0xC,  #   -8.0°C
     321: 0xE,  #   -7.9°C
     322: 0x9,  #   -7.8°C
     324: 0xA,  #   -7.6°C
     325: 0x3,  #   -7.5°C
     326: 0x4,  #   -7.4°C
     328: 0x1,  #   -7.2°C
     329: 0x8,  #   -7.1°C
     330: 0xF,  #   -7.0°C
     331: 0xB,  #   -6.9°C
     332: 0xC,  #   -6.8°C
     333: 0x8,  #   -6.7°C
     334: 0xF,  #   -6.6°C
     335: 0x6,  #   -6.5°C
     336: 0x1,  #   -6.4°C
     338: 0x4,  #   -6.2°C
     340: 0xA,  #   -6.0°C
     341: 0x4,  #   -5.9°C
     342: 0x3,  #   -5.8°C
     343: 0x7,  #   -5.7°C
     344: 0x0,  #   -5.6°C
     346: 0xE,  #   -5.4°C
     347: 0xC,  #   -5.3°C
     349: 0x2,  #   -5.1°C
     350: 0x5,  #   -5.0°C
     352: 0x6,  #   -4.8°C
     354: 0x5,  #   -4.6°C
     355: 0xC,  #   -4.5°C
     356: 0xB,  #   -4.4°C
     357: 0x9,  #   -4.3°C
     359: 0x7,  #   -4.1°C
     360: 0x0,  #   -4.0°C
     361: 0xA,  #   -3.9°C
     362: 0xD,  #   -3.8°C
     363: 0x9,  #   -3.7°C
     364: 0xE,  #   -3.6°C
     365: 0x7,  #   -3.5°C
     367: 0x2,  #   -3.3°C
     368: 0x5,  #   -3.2°C
     369: 0xC,  #   -3.1°C
     371: 0xF,  #   -2.9°C
     373: 0xC,  #   -2.7°C
     374: 0xB,  #   -2.6°C
     376: 0x5,  #   -2.4°C
     378: 0x0,  #   -2.2°C
     379: 0x9,  #   -2.1°C
     380: 0xE,  #   -2.0°C
     381: 0x0,  #   -1.9°C
     383: 0x3,  #   -1.7°C
     385: 0xD,  #   -1.5°C
     387: 0x8,  #   -1.3°C
     390: 0x1,  #   -1.0°C
     392: 0x2,  #   -0.8°C
     394: 0x1,  #   -0.6°C
     396: 0xF,  #   -0.4°C
     398: 0xA,  #   -0.2°C
     400: 0x4,  #    0.0°C
     401: 0xB,  #    0.1°C
     402: 0x2,  #    0.2°C
     403: 0x5,  #    0.3°C
     404: 0x7,  #    0.4°C
     406: 0x9,  #    0.6°C
     408: 0xA,  #    0.8°C
     410: 0x9,  #    1.0°C
     412: 0x7,  #    1.2°C
     413: 0x0,  #    1.3°C
     414: 0x2,  #    1.4°C
     416: 0xC,  #    1.6°C
     417: 0xB,  #    1.7°C
     418: 0xF,  #    1.8°C
     419: 0x8,  #    1.9°C
     420: 0x6,  #    2.0°C
     421: 0x1,  #    2.1°C
     422: 0x8,  #    2.2°C
     423: 0xF,  #    2.3°C
     425: 0xA,  #    2.5°C
     427: 0x4,  #    2.7°C
     428: 0x0,  #    2.8°C
     429: 0x7,  #    2.9°C
     430: 0x3,  #    3.0°C
     431: 0x4,  #    3.1°C
     432: 0xD,  #    3.2°C
     433: 0xA,  #    3.3°C
     434: 0x8,  #    3.4°C
     435: 0xF,  #    3.5°C
     437: 0x1,  #    3.7°C
     438: 0x5,  #    3.8°C
     439: 0x2,  #    3.9°C
     440: 0x8,  #    4.0°C
     441: 0xF,  #    4.1°C
     442: 0x6,  #    4.2°C
     444: 0x3,  #    4.4°C
     446: 0xD,  #    4.6°C
     447: 0xA,  #    4.7°C
     448: 0xE,  #    4.8°C
     449: 0x9,  #    4.9°C
     450: 0xD,  #    5.0°C
     451: 0xA,  #    5.1°C
     452: 0x3,  #    5.2°C
     453: 0x4,  #    5.3°C
     454: 0x6,  #    5.4°C
     455: 0x1,  #    5.5°C
     456: 0x8,  #    5.6°C
     458: 0xB,  #    5.8°C
     459: 0xC,  #    5.9°C
     461: 0x5,  #    6.1°C
     462: 0xC,  #    6.2°C
     463: 0xB,  #    6.3°C
     464: 0x9,  #    6.4°C
     465: 0xE,  #    6.5°C
     466: 0x7,  #    6.6°C
     468: 0x4,  #    6.8°C
     469: 0x3,  #    6.9°C
     471: 0x0,  #    7.1°C
     472: 0x9,  #    7.2°C
     473: 0xE,  #    7.3°C
     474: 0xC,  #    7.4°C
     475: 0xB,  #    7.5°C
     476: 0x2,  #    7.6°C
     477: 0x5,  #    7.7°C
     478: 0x1,  #    7.8°C
     479: 0x6,  #    7.9°C
     480: 0x4,  #    8.0°C
     481: 0x3,  #    8.1°C
     482: 0xA,  #    8.2°C
     484: 0xF,  #    8.4°C
     485: 0x8,  #    8.5°C
     486: 0x1,  #    8.6°C
     488: 0x2,  #    8.8°C
     489: 0x5,  #    8.9°C
     490: 0x1,  #    9.0°C
     491: 0x6,  #    9.1°C
     493: 0x8,  #    9.3°C
     495: 0xD,  #    9.5°C
     496: 0x4,  #    9.6°C
     497: 0x3,  #    9.7°C
     498: 0x7,  #    9.8°C
     499: 0x0,  #    9.9°C
     500: 0xC,  #   10.0°C
     501: 0xB,  #   10.1°C
     502: 0x2,  #   10.2°C
     503: 0x5,  #   10.3°C
     504: 0x7,  #   10.4°C
     505: 0x0,  #   10.5°C
     506: 0x9,  #   10.6°C
     507: 0xE,  #   10.7°C
     508: 0xA,  #   10.8°C
     509: 0xD,  #   10.9°C
     510: 0x9,  #   11.0°C
     511: 0xE,  #   11.1°C
     512: 0x7,  #   11.2°C
     513: 0x0,  #   11.3°C
     514: 0x2,  #   11.4°C
     515: 0x5,  #   11.5°C
     516: 0xC,  #   11.6°C
     517: 0xB,  #   11.7°C
     518: 0xF,  #   11.8°C
     519: 0x8,  #   11.9°C
     520: 0x6,  #   12.0°C
     521: 0x1,  #   12.1°C
     522: 0x8,  #   12.2°C
     523: 0xF,  #   12.3°C
     524: 0xD,  #   12.4°C
     525: 0xA,  #   12.5°C
     526: 0x3,  #   12.6°C
     527: 0x4,  #   12.7°C
     528: 0x0,  #   12.8°C
     529: 0x7,  #   12.9°C
     530: 0x3,  #   13.0°C
     531: 0x4,  #   13.1°C
     532: 0xD,  #   13.2°C
     533: 0xA,  #   13.3°C
     534: 0x8,  #   13.4°C
     535: 0xF,  #   13.5°C
     536: 0x6,  #   13.6°C
     537: 0x1,  #   13.7°C
     538: 0x5,  #   13.8°C
     539: 0x2,  #   13.9°C
     540: 0x8,  #   14.0°C
     541: 0xF,  #   14.1°C
     542: 0x6,  #   14.2°C
     543: 0x1,  #   14.3°C
     544: 0x3,  #   14.4°C
     545: 0x4,  #   14.5°C
     546: 0xD,  #   14.6°C
     547: 0xA,  #   14.7°C
     548: 0xE,  #   14.8°C
     549: 0x9,  #   14.9°C
     550: 0xD,  #   15.0°C
     551: 0xA,  #   15.1°C
     552: 0x3,  #   15.2°C
     553: 0x4,  #   15.3°C
     554: 0x6,  #   15.4°C
     555: 0x1,  #   15.5°C
     556: 0x8,  #   15.6°C
     557: 0xF,  #   15.7°C
     558: 0xB,  #   15.8°C
     559: 0xC,  #   15.9°C
     560: 0x2,  #   16.0°C
     561: 0x5,  #   16.1°C
     562: 0xC,  #   16.2°C
     563: 0xB,  #   16.3°C
     564: 0x9,  #   16.4°C
     565: 0xE,  #   16.5°C
     566: 0x7,  #   16.6°C
     567: 0x0,  #   16.7°C
     568: 0x4,  #   16.8°C
     569: 0x3,  #   16.9°C
     570: 0x7,  #   17.0°C
     571: 0x0,  #   17.1°C
     572: 0x9,  #   17.2°C
     573: 0xE,  #   17.3°C
     574: 0xC,  #   17.4°C
     575: 0xB,  #   17.5°C
     576: 0x2,  #   17.6°C
     577: 0x5,  #   17.7°C
     578: 0x1,  #   17.8°C
     579: 0x6,  #   17.9°C
     580: 0x4,  #   18.0°C
     581: 0x3,  #   18.1°C
     582: 0xA,  #   18.2°C
     583: 0xD,  #   18.3°C
     584: 0xF,  #   18.4°C
     585: 0x8,  #   18.5°C
     586: 0x1,  #   18.6°C
     588: 0x2,  #   18.8°C
     589: 0x5,  #   18.9°C
     591: 0x6,  #   19.1°C
     592: 0xF,  #   19.2°C
     593: 0x8,  #   19.3°C
     595: 0xD,  #   19.5°C
     596: 0x4,  #   19.6°C
     597: 0x3,  #   19.7°C
     598: 0x7,  #   19.8°C
     599: 0x0,  #   19.9°C
     600: 0xC,  #   20.0°C
     601: 0xB,  #   20.1°C
     602: 0x2,  #   20.2°C
     603: 0x5,  #   20.3°C
     604: 0x7,  #   20.4°C
     605: 0x0,  #   20.5°C
     606: 0x9,  #   20.6°C
     607: 0xE,  #   20.7°C
     608: 0xA,  #   20.8°C
     609: 0xD,  #   20.9°C
     610: 0x9,  #   21.0°C
     611: 0xE,  #   21.1°C
     612: 0x7,  #   21.2°C
     613: 0x0,  #   21.3°C
     614: 0x2,  #   21.4°C
     615: 0x5,  #   21.5°C
     616: 0xC,  #   21.6°C
     617: 0xB,  #   21.7°C
     618: 0xF,  #   21.8°C
     619: 0x8,  #   21.9°C
     620: 0x6,  #   22.0°C
     621: 0x1,  #   22.1°C
     622: 0x8,  #   22.2°C
     623: 0xF,  #   22.3°C
     625: 0xA,  #   22.5°C
     626: 0x3,  #   22.6°C
     627: 0x4,  #   22.7°C
     629: 0x7,  #   22.9°C
     631: 0x4,  #   23.1°C
     632: 0xD,  #   23.2°C
     633: 0xA,  #   23.3°C
     634: 0x8,  #   23.4°C
     636: 0x6,  #   23.6°C
     637: 0x1,  #   23.7°C
     639: 0x2,  #   23.9°C
     640: 0x8,  #   24.0°C
     641: 0xF,  #   24.1°C
     642: 0x6,  #   24.2°C
     643: 0x1,  #   24.3°C
     644: 0x3,  #   24.4°C
     645: 0x4,  #   24.5°C
     646: 0xD,  #   24.6°C
     647: 0xA,  #   24.7°C
     649: 0x9,  #   24.9°C
     651: 0xA,  #   25.1°C
     652: 0x3,  #   25.2°C
     653: 0x4,  #   25.3°C
     654: 0x6,  #   25.4°C
     656: 0x8,  #   25.6°C
     657: 0xF,  #   25.7°C
     658: 0xB,  #   25.8°C
     659: 0xC,  #   25.9°C
     660: 0x2,  #   26.0°C
     661: 0x5,  #   26.1°C
     662: 0xC,  #   26.2°C
     663: 0xB,  #   26.3°C
     665: 0xE,  #   26.5°C
     666: 0x7,  #   26.6°C
     667: 0x0,  #   26.7°C
     668: 0x4,  #   26.8°C
     670: 0x7,  #   27.0°C
     671: 0x0,  #   27.1°C
     672: 0x9,  #   27.2°C
     676: 0x2,  #   27.6°C
     680: 0x4,  #   28.0°C
     686: 0x1,  #   28.6°C
     692: 0xF,  #   29.2°C
     699: 0x0,  #   29.9°C
     707: 0xE,  #   30.7°C
     717: 0xB,  #   31.7°C
     728: 0x0,  #   32.8°C
     740: 0x8,  #   34.0°C
     746: 0xD,  #   34.6°C
     753: 0x4,  #   35.3°C
     769: 0x3,  #   36.9°C
     786: 0x1,  #   38.6°C
     807: 0x9,  #   40.7°C
     813: 0x7,  #   41.3°C
     815: 0x2,  #   41.5°C
     830: 0x4,  #   43.0°C
     834: 0xF,  #   43.4°C
     859: 0xB,  #   45.9°C
     866: 0x0,  #   46.6°C
     873: 0x9,  #   47.3°C
     889: 0x2,  #   48.9°C
     896: 0x3,  #   49.6°C
     902: 0x5,  #   50.2°C
     910: 0xE,  #   51.0°C
     915: 0x2,  #   51.5°C
     926: 0x4,  #   52.6°C
     931: 0x3,  #   53.1°C
     965: 0x9,  #   56.5°C
     970: 0x0,  #   57.0°C
     971: 0x7,  #   57.1°C
     979: 0x1,  #   57.9°C
     986: 0x6,  #   58.6°C
    1014: 0x5,  #   61.4°C
}

def get_p(temp_celsius, nib7=0x2):
    """
    Obté P per una temperatura i rolling code.
    
    Args:
        temp_celsius: Temperatura en °C
        nib7: Rolling code (0, 1, 2, o 8)
    
    Returns:
        Nibble P (0-F)
    """
    temp_idx = int(round((temp_celsius + 40) * 10))
    
    # Obtenir P base (Nib7=2)
    if temp_idx not in P_LUT_BASE:
        # Temperatura fora de rang - usar més proper
        closest_idx = min(P_LUT_BASE.keys(), key=lambda k: abs(k - temp_idx))
        p_base = P_LUT_BASE[closest_idx]
    else:
        p_base = P_LUT_BASE[temp_idx]
    
    # Aplicar transformació XOR
    xor_val = NIB7_XOR_TABLE.get(nib7, 0x0)
    return (p_base ^ xor_val) & 0xF
